window.up=window.up||{},window.up.startSurveyPortlet=function(a,b,c){"use strict";function d(){var a=angular.module(g,[]);e(a),angular.bootstrap(document.getElementById(f+"-survey-portlet"),[g])}function e(a){a.directive("modal",["$document",function(a){return{template:"<ng-transclude></ng-transclude>",transclude:!0,restrict:"E",scope:{shown:"=",modalHide:"&?",modalShow:"&?"},link:function(a,b){b.addClass("hidden");var c,d=angular.element('<div class="modal-hider"></div>');a.$watch("shown",function(e){e?(c=!0,b.removeClass("hidden"),d.on("click",function(){a.$apply(function(){a.shown=!a.shown})}),angular.element(document.body).append(d),a.modalShow&&a.modalShow()):(b.addClass("hidden"),c&&a.modalHide&&a.modalHide(),d.off("click"),d&&d.remove())})}}}]),a.directive("ngDrag",["DragData",function(a){return{restrict:"A",link:function(b,c,d){c.attr("draggable","true"),c.on("dragstart",function(c){c.stopPropagation(),c.originalEvent.dataTransfer.setData("ngdrag/type",d.ngDrag||"ngdrag/id"),c.originalEvent.dataTransfer.setData(d.ngDrag||"ngdrag/id",b.$id),a.add(b)})}}}]).directive("ngDrop",["DragData",function(a){return{restrict:"A",link:function(b,c,d){c.on("dragover",function(a){a.preventDefault()}),c.on("dragenter",function(a){a.preventDefault(),a.stopPropagation();var b=a.originalEvent.dataTransfer.getData("ngdrag/type");b===d.allowDrop?event.dataTransfer.dropEffect="move":event.dataTransfer.dropEffect="none"}),c.on("drop",function(c){c.preventDefault();var e=c.originalEvent.dataTransfer.getData(d.allowDrop||"ngdrag/id");if(e){var f=a.get(e);b.$apply(function(){b.$eval(d.ngDrop,{$from:f,$event:c})})}})}}}]).service("DragData",function(){var a={};this.add=function(b){b.$id&&(a[b.$id]=b)},this.get=function(b){return a[b]?a[b]:void 0}}),a.service("StudentProfile",["$http","$q","$timeout",function(a,c,d){var e=this,f="https://portal-mock-api-dev.herokuapp.com/api/";e.get=function(e,g){var h=c.defer();return e||d(function(){h.reject("Missing endpoint for StudentProfile.get")}),g=g||{},a(b.defaults({method:"GET",url:f+e},g)).success(h.resolve).error(h.reject),h.promise},e.save=function(e,g,h){var i=c.defer();e||d(function(){i.reject("Missing endpoint for StudentProfile.save")}),h=h||{},g=g||{};var j=g.id?"POST":"PUT",k=f+e+(g.id?"/"+g.id:"");return a(b.defaults({method:j,url:k,data:g},h)).success(i.resolve).error(i.reject),i.promise}}]),a.service("SurveyMeta",["$http","$filter","$q",function(a,c,d){function e(b){return a({method:"POST",data:b,url:h+"questions/"})}function f(c,d){return e(d.question).success(function(e){return b.extend(d.question,e),a({method:"POST",url:h+c.id+"/questions/"+e.id,data:d}).success(function(a){b.extend(d,a)})})}var g=this,h="/survey-portlet/v1/surveys/";g.surveysById={},g.surveys=[],g.surveys.clear=function(){for(;this.length;)this.pop()},g.getSurveys=function(){return a.get(h).success(function(a){return b.each(a,function(a){g.surveysById[a.id]?b.extend(g.surveysById[a.id],a):g.surveys.push(a)}),a})},g.saveSurvey=function(c){var e=c.id?"PUT":"POST",g=c.id?h+c.id:h,i=[];return i.push(a({method:e,url:g,data:c})),c=angular.copy(c),b.each(c.surveyQuestions,function(b,d){i.push(b.question.id?a({method:"PUT",url:h+"questions/"+b.question.id,data:b.question}):f(c,b))}),d.all(i)};var i={sequence:0,canonicalName:null,answer:{text:null,imgUrl:null,helpText:null,altText:null,imgHeight:0,imgWidth:0}};g.addQa=function(a){a.questionAnswers=a.questionAnswers||[];var b=angular.copy(i);b.sequence=a.questionAnswers.length+1,a.questionAnswers.push(b)};var j={sequence:1,question:{canonicalName:null,status:"UNPUBLISHED",text:null,altText:null,helpText:null},numAllowedAnswers:1};g.addSq=function(a){a.surveyQuestions=a.surveyQuestions||[];var b=angular.copy(j);b.sequence=a.surveyQuestions.length+1,a.surveyQuestions.push(b)};var k={canonicalName:null,text:null,title:null,description:null,altText:null,helpText:null};g.newSurvey=function(){return angular.copy(k)}}]),a.controller("SurveyCtrl",["$scope","$filter","SurveyMeta","StudentProfile",function(a,c,d,e){a.surveys=d.surveys,d.getSurveys(),a.toggle=function(a){a=a||{},a.shown=!a.shown},e.get("surveyAnswers",{params:{user:h}}).then(function(c){c&&c.length&&c[0].answers&&c[0].answers.length&&(b.each(c[0].answers,function(b){a.surveyData[b.question]=b.answer}),a.surveyData.id=c[0].id)}),a.saveAnswers=function(a){delete a.user;var c={answers:b(a).filter(function(a,b){return"id"!=b}).map(function(a,b){return{question:b,answer:a}}).value(),id:a.id,user:h};e.save("surveyAnswers",c).then(function(b){a.id=b.id})},a.addQ=d.addSq,a.addA=d.addQa,a.save=d.saveSurvey,a.swapSeq=function(a,b){var c=a.sequence;a.sequence=b.sequence,b.sequence=c},a.surveyData={}}]),a.directive("surveyQuestion",function(){return{template:'<section class="question"><label class="text">{{def.question.text}}</label><div class="answer" ng-repeat="ans in def.question.questionAnswers | orderBy:\'sequence\'"><label title="{{ans.answer.altText}}" aria-label="{{ans.answer.altText}}" ><img ng-if="ans.answer.imgUrl" ng-src="{{ans.answer.imgUrl}}" height="25px" width="25px"></img><input ng-if="def.numAllowedAnswers === 1" type="radio" ng-model="survey[def.question.id]" ng-value="ans.answer.id" /><input ng-if="def.numAllowedAnswers > 1" type="checkbox" ng-model="survey[def.question.id][ans.answer.id]"/>{{ans.answer.text}}</label><span class="glyphicon glyphicon-info-sign" ng-if="ans.answer.helpText" title="{{ans.answer.helpText}}"></span></div></section>',restrict:"E",scope:{def:"=",survey:"="},link:function(a,b,c){}}})}var f=(c.surveyName||"",c.n),g=f+"-survey-portlet",h="admin";if(a.angular)e(a.up.ngApp);else{var i="angular-uportal-script",j=document.getElementById(i);j||(j=document.createElement("script"),j.id=i,j.type="text/javascript",j.async=!0,j.charset="utf-8",j.src="https://cdnjs.cloudflare.com/ajax/libs/angular.js/1.3.15/angular.js",document.body.appendChild(j)),j.addEventListener("load",d)}};